<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
    Por qué: Hereda del template estándar de orden de compra.
    A diferencia de facturas, NO usa l10n_ar porque no es un documento fiscal.
    -->
    <template id="report_purchaseorder_document_pesos" inherit_id="purchase.report_purchaseorder_document">

        <!--
        ── Estilos para mejorar legibilidad del PDF ──────────────────
        Por qué: El tamaño de fuente por defecto de Odoo es pequeño en papel.
        Aumentamos el tamaño general, de montos y del bloque de totales.
        -->
        <xpath expr="//t[@t-call='web.external_layout']" position="before">
            <style>
                /* Tamaño base del documento */
                .page {
                    font-size: 13px;
                }
                /* Tabla de productos */
                table thead th,
                table tbody td {
                    font-size: 13px;
                }
                /* Montos y precios más legibles */
                table td.text-end span,
                table td span[t-field],
                table td span[t-out] {
                    font-size: 13px;
                }
                /* Bloque de totales al pie */
                #total table td,
                #total table th,
                #total table span {
                    font-size: 14px !important;
                }
            </style>
        </xpath>

        <!-- ── Nota informativa después de la dirección ─────────────── -->
        <!-- Temporalmente comentado
        <xpath expr="//div[@id='informations']" position="after">
            <div t-if="o.print_in_pesos and o._is_foreign_currency()" class="row mt-2">
                <div class="col-12">
                    <strong>Moneda Original:</strong> <span t-field="o.currency_id.name"/>
                    <span class="mx-2">|</span>
                    <strong>Impreso en:</strong> <span t-field="o.company_id.currency_id.name"/>
                </div>
            </div>
        </xpath>
        -->

        <!--
        ── Precios de líneas ─────────────────────────────────────────
        Por qué: Cambiar display_currency condicionalmente según print_in_pesos
        Tip: El template de purchase usa 'o' en lugar de 'doc' como variable.
        -->

        <!-- Precio unitario - cambiar solo la moneda de visualización -->
        <xpath expr="//span[@t-field='line.price_unit']" position="attributes">
            <attribute name="t-options-display_currency">o.company_id.currency_id if (o.print_in_pesos and o._is_foreign_currency()) else o.currency_id</attribute>
            <attribute name="t-out">line.price_unit_pesos if (o.print_in_pesos and o._is_foreign_currency()) else None</attribute>
            <attribute name="t-field">None if (o.print_in_pesos and o._is_foreign_currency()) else line.price_unit</attribute>
        </xpath>

        <!-- Subtotal de línea -->
        <xpath expr="//span[@t-field='line.price_subtotal']" position="attributes">
            <attribute name="t-options-display_currency">o.company_id.currency_id if (o.print_in_pesos and o._is_foreign_currency()) else o.currency_id</attribute>
            <attribute name="t-out">line.price_subtotal_pesos if (o.print_in_pesos and o._is_foreign_currency()) else None</attribute>
            <attribute name="t-field">None if (o.print_in_pesos and o._is_foreign_currency()) else line.price_subtotal</attribute>
        </xpath>

        <!--
        ── Totales ───────────────────────────────────────────────────
        Por qué: Cambiar valores y moneda de visualización condicionalmente
        -->

        <!-- Subtotal (sin impuestos) -->
        <xpath expr="//span[@t-field='o.amount_untaxed']" position="attributes">
            <attribute name="t-options-display_currency">o.company_id.currency_id if (o.print_in_pesos and o._is_foreign_currency()) else o.currency_id</attribute>
            <attribute name="t-out">o.amount_untaxed_pesos if (o.print_in_pesos and o._is_foreign_currency()) else None</attribute>
            <attribute name="t-field">None if (o.print_in_pesos and o._is_foreign_currency()) else o.amount_untaxed</attribute>
        </xpath>

        <!-- Impuestos -->
        <xpath expr="//span[@t-field='o.amount_tax']" position="attributes">
            <attribute name="t-options-display_currency">o.company_id.currency_id if (o.print_in_pesos and o._is_foreign_currency()) else o.currency_id</attribute>
            <attribute name="t-out">o.amount_tax_pesos if (o.print_in_pesos and o._is_foreign_currency()) else None</attribute>
            <attribute name="t-field">None if (o.print_in_pesos and o._is_foreign_currency()) else o.amount_tax</attribute>
        </xpath>

        <!-- Total -->
        <xpath expr="//span[@t-field='o.amount_total']" position="attributes">
            <attribute name="t-options-display_currency">o.company_id.currency_id if (o.print_in_pesos and o._is_foreign_currency()) else o.currency_id</attribute>
            <attribute name="t-out">o.amount_total_pesos if (o.print_in_pesos and o._is_foreign_currency()) else None</attribute>
            <attribute name="t-field">None if (o.print_in_pesos and o._is_foreign_currency()) else o.amount_total</attribute>
        </xpath>

        <!-- ── Nota al pie de totales ────────────────────────────────── -->
        <xpath expr="//div[hasclass('page')]" position="inside">
            <div t-if="o.print_in_pesos and o._is_foreign_currency()"
                 class="text-muted small mt-4 text-center" style="font-style: italic; border-top: 1px solid #ddd; padding-top: 10px;">
                <strong>Valores expresados en <t t-out="o.company_id.currency_id.name"/></strong> —
                Moneda original: <t t-out="o.currency_id.name"/> —
                Tipo de Cambio: <t t-out="o.manual_currency_rate" t-options='{"widget": "float", "precision": 4}'/> —
                Fecha: <t t-out="o.date_order" t-options='{"widget": "date"}'/>
            </div>
        </xpath>

    </template>
</odoo>
