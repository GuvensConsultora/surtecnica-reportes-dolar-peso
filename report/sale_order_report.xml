<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--
    Por qué: Hereda del template estándar de presupuesto de venta.
    A diferencia de facturas, NO usa l10n_ar porque no es un documento fiscal.
    -->
    <template id="report_saleorder_document_pesos" inherit_id="sale.report_saleorder_document">

        <!--
        ── Estilos para mejorar legibilidad del PDF ──────────────────
        Por qué: El tamaño de fuente por defecto de Odoo es pequeño en papel.
        Aumentamos el tamaño general, de montos y del bloque de totales.
        -->
        <xpath expr="//t[@t-call='web.external_layout']" position="before">
            <style>
                /* Tamaño base del documento */
                .page {
                    font-size: 13px;
                }
                /* Tabla de productos */
                table thead th,
                table tbody td {
                    font-size: 13px;
                }
                /* Montos y precios más legibles */
                table td.text-end span,
                table td span[t-field],
                table td span[t-out] {
                    font-size: 13px;
                }
                /* Bloque de totales al pie */
                #total table td,
                #total table th,
                #total table span {
                    font-size: 14px !important;
                }
            </style>
        </xpath>

        <!-- ── Nota informativa después de la dirección ─────────────── -->
        <!-- Temporalmente comentado
        <xpath expr="//div[@id='informations']" position="after">
            <div t-if="doc.print_in_pesos and doc._is_foreign_currency()" class="row mt-2">
                <div class="col-12">
                    <strong>Moneda Original:</strong> <span t-field="doc.currency_id.name"/>
                    <span class="mx-2">|</span>
                    <strong>Impreso en:</strong> <span t-field="doc.company_id.currency_id.name"/>
                </div>
            </div>
        </xpath>
        -->

        <!--
        ── Precios de líneas ─────────────────────────────────────────
        Por qué: Cambiar display_currency condicionalmente según print_in_pesos
        -->

        <!-- Precio unitario - cambiar solo la moneda de visualización -->
        <xpath expr="//span[@t-field='line.price_unit']" position="attributes">
            <attribute name="t-options-display_currency">doc.company_id.currency_id if (doc.print_in_pesos and doc._is_foreign_currency()) else doc.currency_id</attribute>
            <attribute name="t-out">line.price_unit_pesos if (doc.print_in_pesos and doc._is_foreign_currency()) else None</attribute>
            <attribute name="t-field">None if (doc.print_in_pesos and doc._is_foreign_currency()) else line.price_unit</attribute>
        </xpath>

        <!-- Subtotal de línea -->
        <xpath expr="//span[@t-field='line.price_subtotal']" position="attributes">
            <attribute name="t-options-display_currency">doc.company_id.currency_id if (doc.print_in_pesos and doc._is_foreign_currency()) else doc.currency_id</attribute>
            <attribute name="t-out">line.price_subtotal_pesos if (doc.print_in_pesos and doc._is_foreign_currency()) else None</attribute>
            <attribute name="t-field">None if (doc.print_in_pesos and doc._is_foreign_currency()) else line.price_subtotal</attribute>
        </xpath>

        <!-- Totales: XPath no funciona en Odoo 17 sale.order - elementos no existen -->

        <!-- ── Nota al pie de totales ────────────────────────────────── -->
        <xpath expr="//div[hasclass('page')]" position="inside">
            <div t-if="doc.print_in_pesos and doc._is_foreign_currency()"
                 class="text-muted small mt-4 text-center" style="font-style: italic; border-top: 1px solid #ddd; padding-top: 10px;">
                <strong>Valores expresados en <t t-out="doc.company_id.currency_id.name"/></strong> —
                Moneda original: <t t-out="doc.currency_id.name"/> —
                Tipo de Cambio: <t t-out="doc.manual_currency_rate" t-options='{"widget": "float", "precision": 4}'/> —
                Fecha: <t t-out="doc.date_order" t-options='{"widget": "date"}'/>
            </div>
        </xpath>

    </template>
</odoo>
